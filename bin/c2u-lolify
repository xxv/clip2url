#!/bin/bash
# Republishes the URL in the clipboard/selection as an Impact-captioned
# LOLcat-style image
# requires:
#    publish_clip
# Debian packages:  curl zenity imagemagick msttcorefonts

url=`xclip -o`
if [[ ! ( "${url:0:7}" == "http://" || "${url:0:7}" == "file://" || "${url:0:8}" == "https://" ) ]]; then
    echo "need an image URL in the clipboard"
    exit 1;
fi

extension="${url##*.}"

# if it's more than 4, it's probably something we don't understand
if [[ "${#extension}" > 4 ]]; then
    extension="jpg";
fi

text=`gdialog --inputbox "enter LOL caption" 0 0 "ORLY?" 2>&1`

if [ -z "$text" ]; then
    exit 1
fi

gravity=`gdialog --menu "Text Position" 0 0 3 North "Top of image" South "Bottom of image" 2>&1`

if [ -z "$gravity" ]; then
    exit 1
fi

size=`gdialog --inputbox "enter size, in px" 0 0 "80" 2>&1`

if [ -z "$size" ]; then
    exit 1
fi

curl $url | convert -font Impact-Regular -pointsize "$size" -strokewidth 2 -fill white -stroke black -gravity "$gravity" -annotate 0 "$text" -quality 90 - "$extension":- | c2u-stdin "$extension" "LOLified image"
